<!DOCTYPE html>
<html>
<head>
    <title>Create Quote Request</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<header>
    <h1>Smile & Sunshine</h1>
    <nav>
        <a href="dashboard.html">Dashboard</a>
        <a href="wishlist.html">Wish List</a>
        <a href="history.html">History</a>
        <a href="#" onclick="logout()">Logout</a>
    </nav>
</header>

<div class="container fade-in">
    <div class="card">
        <h2>Design Your Custom Toy</h2>
        <form id="quoteForm">
            <label>Upload Sketch (Image)</label>
            <input type="file" id="sketch" accept="image/*" required>

            <label>Dimensions (e.g., 20x15x10 cm)</label>
            <input type="text" id="dimensions" required>

            <label>Pantone Color</label>
            <input type="color" id="pantone" value="#FF5733">
            <span class="color-preview" id="colorPrev"></span>

            <label>Materials (comma-separated)</label>
            <textarea id="materials" rows="3" required></textarea>

            <label>Quantity</label>
            <input type="number" id="quantity" min="1" value="1" required>

            <label>Preferred Payment Method</label>
            <select id="payment" required>
                <option>Credit Card</option>
                <option>PayPal</option>
                <option>Bank Transfer</option>
            </select>

            <button type="submit" class="btn btn-primary">Add to Wish List</button>
        </form>
    </div>
</div>

<script src="../js/auth.js"></script>
<script>
    const user = getCurrentUser();
    if (!user || user.type !== 'Customer') window.location.href = '../common/login.html';

    document.getElementById('pantone').addEventListener('input', e => {
        document.getElementById('colorPrev').style.background = e.target.value;
    });

    document.getElementById('quoteForm').onsubmit = function(e) {
        e.preventDefault();
        const file = document.getElementById('sketch').files[0];
        if (!file) { alert('Please upload a sketch'); return; }

        const reader = new FileReader();
        reader.onload = function(ev) {
            const quote = {
                id: 'Q' + Date.now(),
                customerEmail: user.email,
                status: 'Pending',
                createdAt: new Date().toISOString().split('T')[0],
                toy: {
                    sketch: ev.target.result,
                    dimensions: document.getElementById('dimensions').value,
                    pantone: document.getElementById('pantone').value,
                    materials: document.getElementById('materials').value,
                    quantity: parseInt(document.getElementById('quantity').value)
                },
                paymentMethod: document.getElementById('payment').value,
                quote: null,
                deliveryDate: null,
                messages: []
            };

            let quotes = JSON.parse(localStorage.getItem('quotes') || '[]');
            quotes.push(quote);
            localStorage.setItem('quotes', JSON.stringify(quotes));
            alert('Added to Wish List! Go to Wish List to submit.');
            window.location.href = 'wishlist.html';
        };
        reader.readAsDataURL(file);
    };
</script>
</body>
</html>